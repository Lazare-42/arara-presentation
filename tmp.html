<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Android Indoor Positioning</title>
		<style>
		html{
			height: 100%;
		}
		body{
			display:flex;
			background-color: #000000;
			margin:auto;
			align-items: center;
			height: 100%;
		}
		#svg_container {
			display:flex;
			margin:auto;
			text-align:center;
			z-index:10;
		}
		#logo {
			max-width: 10%;
			position: absolute;
			right:0;
			bottom:0;
				bottom;
		}
		</style>
	</head>

	<body>
		<div id="svg_container" style="text-align: center;">
			<object id="logo" data="/resources/AraraDS2.svg" type="image/svg+xml"></object>
		</div>

	<script src="//d3js.org/d3.v4.min.js"></script>
	<script src="https://unpkg.com/viz.js@1.8.0/viz.js" type="javascript/worker"></script>
	<script src="https://unpkg.com/d3-graphviz@1.3.1/build/d3-graphviz.min.js"></script>

	<script>

var dotIndex = 0;
var graphviz = d3.select("#svg_container").graphviz()

function render(dotSrc) {
	console.log('DOT source =', dotSrc);
	dot = dotSrc.join('');
	console.log(dot)

	transition1 = d3.transition()
		.delay(1000)
		.duration(1000);

	graphviz
		.transition(transition1)
		.renderDot(dot);

	nodes = d3.selectAll('.node,.edge');
	nodes
		.on("click", function () {
			console.log('erick')
			debugger
			var title = d3.select(this).selectAll('title').text().trim();
			var text = d3.select(this).selectAll('text').text();
			var id = d3.select(this).attr('id');
			var class1 = d3.select(this).attr('class');
			dotElement = title.replace('->',' -> ');
			console.log('Element id="%s" class="%s" title="%s" text="%s" dotElement="%s"', id, class1, title, text, dotElement);
			console.log('Finding and deleting references to %s "%s" from the DOT source', class1, dotElement);
			for (i = 0; i < dotSrcLines.length;) {
				if (dotSrcLines[i].indexOf(dotElement) >= 0) {
					console.log('Deleting line %d: %s', i, dotSrcLines[i]);
					dotSrcLines.splice(i, 1);
				} else {
					i++;
				}
			}
			render(dotSrc);
		});
}

function getDot() {
	fetch("http://0.0.0.0:5000/resources/arara.dot").then(res => res.text()).then((allTheDot =>
		{
			var digraphArray = allTheDot.split("/*CUT*/")
			digraphArray.forEach(d => console.log(d) || d)
			render(digraphArray)
		}))
}
getDot()

//var dots = [
//		[
//		'digraph name{',
//		'	concentrate = true;',
//		'	araraipsServer;',
//		'	araraipsServer	->		androidJava		[dir="both"];',
//		'	androidJava		->		androidScreen	[dir="both"];',
//		'}'
//		],
//		[
//		'digraph name{',
//		'	concentrate = true;',
//		'	araraipsServer [shape="square"]',
//		'	araraipsServer	->		androidJava',
//		'	androidJava		->		araraipsServer	[dir="both"]',
//		'	androidJava		->		androidScreen	[dir="both"];',
//		'}'
//		],
//	];
//
	</script>
	</body>
</html>
